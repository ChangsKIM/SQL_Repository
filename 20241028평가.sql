CREATE USER C##KCS7601 IDENTIFIED BY 123456;

GRANT RESOURCE, CONNECT, CREATE VIEW TO C##KCS7601;

ALTER USER C##KCS7601 DEFAULT TABLESPACE USERS QUOTA UNLIMITED ON USERS;


  CREATE TABLE STUDENT 
   (	STD_NO CHAR(8 BYTE), 
	MAJOR_NO NUMBER(2,0), 
	STD_NAME VARCHAR2(30 BYTE), 
	STD_SCORE NUMBER(3,2), 
	STD_TEL CHAR(11 BYTE), 
	STD_EMAIL VARCHAR2(100 BYTE)
   ) ;

  CREATE TABLE MAJOR 
   (	MAJOR_NO NUMBER(2,0), 
	MAJOR_NAME VARCHAR2(30 BYTE)
   ) ;

  CREATE TABLE SQL_LOGS 
   (	LOG_ID NUMBER GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE , 
	EXECUTION_TIME TIMESTAMP (6) DEFAULT SYSTIMESTAMP, 
	EXECUTED_COMMAND CLOB, 
	TABLE_NAME VARCHAR2(128 BYTE), 
	CHANGED_CONTENT CLOB
   ) ;

Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230001',1,'김민준',3.85,'01012345678','minjun.kim@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230002',1,'이서연',4.1,'01023456789','seoyeon.lee@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230003',1,'박지훈',3.5,'01034567890','jihun.park@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230004',1,'최수민',3.95,'01045678901','sumin.choi@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230005',1,'정예은',4.2,'01056789012','yeeun.jung@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230006',2,'김도현',3.7,'01067890123','dohyun.kim@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230007',2,'윤서진',3.8,'01078901234','seojin.yoon@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230008',2,'장민서',4.25,'01089012345','minseo.jang@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230009',2,'임채원',3.6,'01090123456','chaewon.lim@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230010',2,'한지우',4,'01091234567','jiwoo.han@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230011',3,'오하준',3.45,'01022334455','hajun.oh@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230012',3,'서윤아',4.15,'01033445566','youna.seo@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230013',3,'신동현',3.8,'01044556677','donghyun.shin@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230014',3,'황서영',3.95,'01055667788','seoyoung.hwang@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230015',3,'문지수',4.3,'01066778899','jisu.moon@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230016',4,'강민재',3.55,'01077889900','minjae.kang@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230017',4,'조예진',4.05,'01088990011','yejin.jo@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230018',4,'홍승우',3.65,'01099001122','seungwoo.hong@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230019',4,'권하은',4.4,'01010111223','haeun.kwon@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230020',4,'김준호',3.75,'01011223344','junho.kim@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230021',5,'임서준',3.9,'01012344321','seojun.lim@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230022',5,'박채은',4.2,'01023455432','chaeun.park@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230023',5,'윤도훈',3.85,'01034566543','dohun.yoon@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230024',5,'장민지',3.95,'01045677654','minji.jang@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230025',5,'최영민',4.1,'01056788765','youngmin.choi@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230026',6,'정지우',3.6,'01067899876','jiwoo.jung@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230027',6,'한서현',4.35,'01078910987','seohyun.han@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230028',6,'김도윤',3.7,'01089021098','doyun.kim@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230029',6,'오하린',4,'01090132109','harin.oh@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230030',6,'서준서',3.8,'01091243210','junseo.seo@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230031',7,'박하은',3.95,'01022334466','haeun.park@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230032',7,'최민성',4.05,'01033445577','minseong.choi@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230033',7,'윤서아',3.65,'01044556688','seoa.yoon@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230034',7,'강지훈',4.25,'01055667799','jihun.kang@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230035',7,'김예빈',3.75,'01066778800','yebin.kim@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230036',8,'이도연',3.85,'01077889911','doyeon.lee@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230037',8,'정서윤',4.1,'01088990022','seoyun.jung@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230038',8,'임하율',3.55,'01099001133','hayul.lim@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230039',8,'문수아',4.05,'01010112234','sua.moon@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230040',8,'한지민',3.9,'01011223345','jimin.han@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230041',9,'조민규',3.7,'01012334456','mingyu.jo@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230042',9,'서예원',4.2,'01023445567','yewon.seo@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230043',9,'오동현',3.8,'01034556678','donghyun.oh@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230044',9,'강서우',4.15,'01045667789','seowoo.kang@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230045',9,'김주원',3.65,'01056778890','juwon.kim@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230046',10,'윤하진',4,'01067889901','hajin.yoon@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230047',10,'장수민',3.75,'01078990012','sumin.jang@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230048',10,'최민호',4.05,'01089001123','minho.choi@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230049',10,'박서연',3.85,'01090112234','seoyeon.park@example.com');
Insert into STUDENT (STD_NO,MAJOR_NO,STD_NAME,STD_SCORE,STD_TEL,STD_EMAIL) 
values ('20230050',10,'김도연',4.3,'01091223345','doyeon.kim@example.com');

Insert into MAJOR (MAJOR_NO,MAJOR_NAME) values (1,'국어국문학과');
Insert into MAJOR (MAJOR_NO,MAJOR_NAME) values (2,'영어영문학과');
Insert into MAJOR (MAJOR_NO,MAJOR_NAME) values (3,'경영학과');
Insert into MAJOR (MAJOR_NO,MAJOR_NAME) values (4,'컴퓨터공학과');
Insert into MAJOR (MAJOR_NO,MAJOR_NAME) values (5,'기계공학과');
Insert into MAJOR (MAJOR_NO,MAJOR_NAME) values (6,'전자공학과');
Insert into MAJOR (MAJOR_NO,MAJOR_NAME) values (7,'경제학과');
Insert into MAJOR (MAJOR_NO,MAJOR_NAME) values (8,'화학과');
Insert into MAJOR (MAJOR_NO,MAJOR_NAME) values (9,'수학과');
Insert into MAJOR (MAJOR_NO,MAJOR_NAME) values (10,'물리학과');

  ALTER TABLE STUDENT MODIFY (STD_NO NOT NULL ENABLE);
  ALTER TABLE STUDENT MODIFY (MAJOR_NO NOT NULL ENABLE);
  ALTER TABLE STUDENT ADD CONSTRAINT PK_STUDENT PRIMARY KEY (STD_NO)
  USING INDEX  ENABLE;

  ALTER TABLE MAJOR MODIFY (MAJOR_NO NOT NULL ENABLE);
  ALTER TABLE MAJOR ADD CONSTRAINT PK_MAJOR PRIMARY KEY (MAJOR_NO)
  USING INDEX  ENABLE;

  ALTER TABLE SQL_LOGS MODIFY (EXECUTION_TIME NOT NULL ENABLE);
  ALTER TABLE SQL_LOGS MODIFY (EXECUTED_COMMAND NOT NULL ENABLE);
  ALTER TABLE SQL_LOGS MODIFY (TABLE_NAME NOT NULL ENABLE);
  ALTER TABLE SQL_LOGS ADD PRIMARY KEY (LOG_ID)
  USING INDEX  ENABLE;

  ALTER TABLE STUDENT ADD CONSTRAINT STUDENT_FK_MAJOR_NO FOREIGN KEY (MAJOR_NO)
	  REFERENCES MAJOR (MAJOR_NO) ENABLE;
	 
	 
-- 문제 01
-- 1. STUDENT 테이블과 MAJOR 테이블을 조인하여 각 학생의 학번, 이름, 학과명, 평점을 조회하는 
-- 뷰 STUDENT_VIEW를 생성하는데 이때,
-- 평점이 3.5 이상인 학생만 포함되도록 하며, 학과명은 MAJOR_NAME 컬럼을 사용하여 만들었으나 오류가 생겼다.
-- 해당 오류를 보고 에러 원인을 쓰고 수정한 SQL문을 제출하세요.
CREATE OR REPLACE VIEW STUDENT_VIEW
IS
SELECT
*
FROM
STUDENT S
JOIN MAJOR M
WHERE
S.STD_SCORE >= 3.5;	 
	 
-- 답
CREATE OR REPLACE VIEW STUDENT_VIEW AS
SELECT 
    S.STD_NO,
    S.STD_NAME,
    M.MAJOR_NAME,
    S.STD_SCORE
FROM STUDENT S
JOIN MAJOR M ON S.MAJOR_NO = M.MAJOR_NO
WHERE S.STD_SCORE >= 3.5; 
-- 뷰 정의의 키워드 오류: VIEW 생성 시 IS가 아니라 AS 키워드를 사용
-- 컬럼 지정 오류: SELECT * 구문은 뷰 생성 시 명확한 컬럼을 지정
-- 조인 구문 오류: JOIN 구문에서는 ON 절을 사용

-- 문제 02
-- 2. MAJOR 테이블의 MAJOR_NO 컬럼에 자동으로 학과 번호를 부여하기 위한 시퀀스 
-- SEQ_MAJOR_NO를 생성하여 데이터를 넣는 도중 문제가 생겼다.
-- 무슨 문제인지 파악 후 해당 시퀸스를 만드는 SQL문을 수정하여 제출하세요.
CREATE SEQUENCE SEQ_MAJOR_NO
START WITH 1
INCREMENT BY 1
NOCACHE;

CREATE SEQUENCE SEQ_MAJOR_NO
START WITH 1
INCREMENT BY 1
NOCACHE;



-- 문제 03
-- 3. STUDENT 테이블에서 STD_TEL 컬럼을 사용하여 학생 정보를 효율적으로 
-- 검색할 수 있도록 IDX_STUDENT_TEL이라는 이름의 인덱스를 생성 중에 오류가 생겼다.
-- 무슨 문제인지 파악 후 해당 인덱스를 만드는 SQL문을 수정하여 제출하세요.

CREATE INDEX IDX_STUDENT_TEL ON STUDENT(STD_NAME);

-- 답안
CREATE INDEX IDX_STUDENT_TEL ON STUDENT(STD_TEL);



-- 문제 04
-- 4. 학생의 평점(STD_SCORE)을 입력받아 성적 등급을 반환하는 함수 
-- FN_GET_GRADE를 작성하는데 오류가 생겼다.
-- 성적 등급은 다음 기준에 따릅니다. 어떤 문제가 생겼는지 적고, 이를 수정한 SQL문을 제출하세요

-- • 4.0 이상: A
-- • 3.5 이상 4.0 미만: B
-- • 3.0 이상 3.5 미만: C
-- • 2.5 이상 3.0 미만: D
-- • 2.5 미만: F

CREATE OR REPLACE FUNCTION FN_GET_GRADE(p_score NUMBER)
RETURN VARCHAR2 IS
v_grade NUMBER(1);
AFTER
IF p_score >= 4.0 THEN
v_grade := 'A';
ELSIF p_score >= 3.5 THEN
v_grade := 'B';
ELSIF p_score >= 3.0 THEN
v_grade := 'C';
ELSE p_score >= 2.5 THEN
v_grade := 'D';
ELSE
v_grade := 'F';
END IF;
RETURN v_grade;
END;

-- 답안
CREATE OR REPLACE FUNCTION FN_GET_GRADE(p_score NUMBER)
RETURN VARCHAR2 IS
    v_grade VARCHAR2(1);  -- v_grade를 VARCHAR2 타입으로 변경
BEGIN
    IF p_score >= 4.0 THEN
        v_grade := 'A';
    ELSIF p_score >= 3.5 THEN
        v_grade := 'B';
    ELSIF p_score >= 3.0 THEN
        v_grade := 'C';
    ELSIF p_score >= 2.5 THEN
        v_grade := 'D';
    ELSE
        v_grade := 'F';
    END IF;

    RETURN v_grade;
END;


-- 문제 05
-- 5. 학생 데이터를 STUDENT 테이블에 추가 후에 실행되는 트리거 
-- TRG_STUDENT_INSERT_LOG를 작성하는데 문제가 생겼다.
-- 이 트리거는 방금 만든 SQL_LOGS 테이블에 다음 정보를 저장합니다. 
-- 어떤 문제가 생겼는지 적고, 이를 수정한 SQL문을 제출하세요.

CREATE OR REPLACE TRIGGER TRG_STUDENT_INSERT_LOG
AFTER DELETE ON STUDENT  -- DELETE > INSERT
FOR EACH ROW
BEGIN
INSERT INTO SQL_LOGS (
EXECUTED_COMMAND,
TABLE_NAME,
CHANGED_CONTENT
) 
VALUES (
'INSERT',
'STUDENT',
'STD_NO: ' || :OLD.STD_NO ||   -- OLD >> NEW
', STD_NAME: ' || :OLD.STD_NAME ||  -- OLD >> NEW
', MAJOR_NO: ' || TO_CHAR(:NEW.MAJOR_NO)
);
END;
	 
-- 답안
CREATE OR REPLACE TRIGGER TRG_STUDENT_INSERT_LOG
AFTER INSERT ON STUDENT 
FOR EACH ROW
BEGIN
    INSERT INTO SQL_LOGS (
        EXECUTED_COMMAND,
        TABLE_NAME,
        CHANGED_CONTENT
    ) VALUES (
        'INSERT', 
        'STUDENT',  
        'STD_NO: ' || :NEW.STD_NO ||  
        ', STD_NAME: ' || :NEW.STD_NAME || 
        ', MAJOR_NO: ' || TO_CHAR(:NEW.MAJOR_NO)
    );
END;
	 
